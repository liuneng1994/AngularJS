# Angular表达式

Angular表达式是类Javascript代码片段,主要使用在插值\(interpolation\)绑定中,例如,`<span title="{{ attrBinding }}">{{ textBinding }}</span>`,但是也被直接在指令的属性中使用,如`ng-click="functionExpression()"`.

下面是一些合法的Angular表达式:

* `1+2`
* `a+b`
* `user.name`
* `items[index]`

## Angular表达式  VS.  Javascript表达式

Angular表达式和Javascript表达式非常相似,但也有以下的不同点:
*  **上下文**:Javascript表达式是在全局作用域`window`下执行的.在Angular中,表达式是在一个scope对象中执行的.
*  **宽松的**:在Javascript中,尝试去求一个`undefined`属性的值会产生`ReferenceError`或者`TypeError`.在Angular中则不会.
*  **过滤器**:你可以使用带有过滤器的表达式去格式化数据的显示格式.
*  **没有控制流程语句**:你在Angular表达式中使用条件判断,循环或者异常.
*  **没有函数声明**:你不能在Angular表达式中声明函数,即使在`ng-init`指令内.
*  **不能通过字面量来创建正则表达式**:你不能在Angular表达式中创建正则表达式.
* **不能new对象**:你不能在Angular表达式中使用`new`操作符.
*  **没有位操作符,逗号及void操作符**:你不能在Angular表达式中使用位操作符,`,`或者`void`操作符在Angular表达式.

如果你想要运行更复杂的Javascript代码,你应该创建一个控制器方法并从你的视图中调用方法.如果你想通过`eval()`执行一个Angular表达式,请使用`$eval()`方法.

##示例

你可以下下面的例子中计算不同的表达式:
**index.html**
```html
<div ng-controller="ExampleController" class="expressions">
  Expression:
  <input type='text' ng-model="expr" size="80"/>
  <button ng-click="addExp(expr)">Evaluate</button>
  <ul>
   <li ng-repeat="expr in exprs track by $index">
     [ <a href="" ng-click="removeExp($index)">X</a> ]
     <code>{{expr}}</code> => <span ng-bind="$parent.$eval(expr)"></span>
    </li>
  </ul>
</div>
```
**script.js**
```js
angular.module('expressionExample', [])
.controller('ExampleController', ['$scope', function($scope) {
  var exprs = $scope.exprs = [];
  $scope.expr = '3*10|currency';
  $scope.addExp = function(expr) {
    exprs.push(expr);
  };

  $scope.removeExp = function(index) {
    exprs.splice(index, 1);
  };
}]);
```
##上下文

Angular不能使用Javascript的`eval()`去执行表达式.替代的应该使用Angular的`$parse`服务去处理这些表达式.

Angular表达式不能访问全局变量如`window`,`document`或`location`.这是限制是刻意的.这样可以阻止意外的存取全局状态--细小bug的源头.

替代它们的是`$window`和`$location`服务,在表达式中通过函数调用它们.这些服务提供对全局变量的可伪造访问.

可以通过使用`this`标识符访问上下文对象,通过`$local`标识符访问本地对象.

##宽松的

表达式的求值对`undefined`和`null`是宽松的.在Javascript中,如果`a`不是一个对象,在求`a.b.c`时会抛出一个异常.这对一个通用型语言来说是合理的,表达式求值主要是使用数据绑定,看上去像:`{{a.b.c}}`.

如果`a`是未定义的,不显示任何值更加合理(或许正在等待服务器的响应,或者很快就会被定义).如果表达式的求值不宽松的话,我们将不得不写一些杂乱的代码,例如`{{((a||{}).b||{}).c}}`.同样的在`undefined`或`null`上执行一个函数`a.b.c()`,只会简单的返回一个`undefined`.

##没有控制流程



